# Muscle Statistical Shape Modelling Pipeline

This repository contains the full computational workflow used for muscle statistical shape modelling (SSM), principal component analysis (PCA), and shape–force regression analysis.

The repository includes all code required to reproduce the preprocessing, modelling, evaluation, visualization, and regression steps.

⚠️ **No patient-derived data are included.**  
Segmentations, meshes, particle files, and clinical measurements are excluded.

---

## Repository Overview

The workflow consists of two main notebooks:

1. `grooming_pipeline.ipynb`  
   Preprocessing, alignment, template construction, and mesh generation

2. `shapeworks_experiment.ipynb`  
   Shape modelling, PCA analysis, model evaluation, visualization, and shape–force regression

---

# 1. grooming_pipeline.ipynb

This notebook performs preprocessing and geometric normalization.

## Required Input

- A folder containing muscle segmentations (one per subject)
- Supported formats: `.nrrd`, `.nii`, or other SimpleITK-compatible formats
- Segmentations must be aligned to a consistent coordinate system

> Segmentations are not included in this repository.

## Pipeline Steps

### 1. Muscle Extraction
- Extracts the muscle of interest from each segmentation volume
- Generates isolated binary masks

### 2. Grooming
- Resampling to consistent voxel spacing
- Cropping and padding
- Centering
- Optional smoothing

### 3. Template Construction
- Iterative alignment
- Distance-map averaging
- Template refinement

### 4. Alignment and Meshing
Two preprocessing strategies are implemented `(mod)`:

- **Rigid alignment**
- **Volume-normalized alignment** (removes global scale to isolate proportional shape variation)

## Output

Generated meshes are saved to: `data/`

These meshes are used as input for statistical shape modelling.
⚠️ Meshes files are not included in this repository.

---

# 2. shapeworks_experiment.ipynb

This notebook performs statistical shape modelling and downstream analysis.

## Input

- Meshes generated by `grooming_pipeline.ipynb`
- Located in `data/`

## Pipeline Steps

### 1. Shape Model Construction (ShapeWorks)

- Particle-based correspondence optimization
- Multi-scale particle system
- Optimization via ShapeWorks API

Outputs:
- Particle files (`.particles`) in `projects/{muscle_name}`
⚠️ Particle files are not included in this repository.


---

### 2. PCA Analysis

- Principal component computation
- Eigenvalues and explained variance
- Mode extraction

Saved in: `projects/{muscle_name}/{muscle_name}_{mod}_left_analysis`


### 3. Model Evaluation

Standard SSM evaluation metrics:

- Compactness
- Generalization
- Specificity

### 3. PC Visualization

Saved in: `projects/{muscle_name}/{muscle_name}_{mod}_left_analysis/pca_heatmaps`


### 4. Shape–Force Regression Analysis

Located in: `regression`




